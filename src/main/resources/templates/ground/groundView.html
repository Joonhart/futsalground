<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="/css/carousel.css" rel="stylesheet">
    <head>
        <meta charset="UTF-8">
        <title>Ground List</title>
        <style>
            .box {
                width: 500px;
                height: 300px;
                border: 1px black solid;
                display: inline-block;
                text-align: left;
                font-size: 1.2em;
                potision:relative;
            }
            #timeColor {
                text-align: center;
                padding-top:12px;
                color: #171a1d;
            }
            .rev {
                width:110px;
                display: inline-block;
                float: contour;
                background-color: #adff2f;
                margin: 0 auto 0 5px;
                text-align: center;
            }
            .info-table {
                margin: 30px 0 0 50px;
            }
            .info-table th {
                width: 150px;
                height: 30px;
            }

        </style>
    </head>
<body>
<header>
    <div th:replace="fragments/bodyHeader :: menu('ground')"/>
</header>


<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <svg class="bd-placeholder-img" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"
                 preserveAspectRatio="xMidYMid slice" focusable="false" role="img">
                <rect width="100%" height="100%"/>
                <image th:href="'/img/ground/' + ${groundViewDto.id} + '_1.jpg'"
                       height="100%" width="100%" x="0" y="0"/>
            </svg>
        </div>
        <div class="carousel-item">
            <svg class="bd-placeholder-img" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"
                 preserveAspectRatio="xMidYMid slice" focusable="false" role="img">
                <rect width="100%" height="100%"/>
                <image th:href="'/img/ground/' + ${groundViewDto.id} + '_2.jpg'"
                       height="100%" width="100%" x="0" y="0"/>
            </svg>
        </div>
        <div class="carousel-item">
            <svg class="bd-placeholder-img" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"
                 preserveAspectRatio="xMidYMid slice" focusable="false" role="img">
                <rect width="100%" height="100%"/>
                <image th:href="'/img/ground/' + ${groundViewDto.id} + '_3.jpg'" height="100%" width="100%"
                       x="0" y="0"></image>
            </svg>
        </div>
    </div>
    <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

<div class="container">
    <div class="py-2 mx-5 title">
        <h2 th:text="${groundViewDto.grdName}"></h2>
        <br />
        <h4 th:text="${groundViewDto.roadAddr}"></h4>
    </div>
    <!--    <button class="btn-info rounded mx-2">지도보기</button>-->

    <div class="d-flex justify-content-around">
        <!--시설정보-->
        <div class="box">
            <table class="info-table">
                <tr>
                    <th colspan="2"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-diamond-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435z"/>
                    </svg><span class="h5"> 구장안내</span></th>
                </tr>
                <tr><th></th><td></td></tr>
                <tr>
                    <th>구장크기</th>
                    <td><span th:text="${groundViewDto.size1} + 'm X ' + ${groundViewDto.size2} + 'm'"></span></td>
                </tr>
                <tr>
                    <th>추천인원</th>
                    <td><span th:text="${groundViewDto.matchtype}"></span></td>
                </tr>
                <tr>
                    <th>실내/실외</th>
                    <td><span th:text="${groundViewDto.groundInfo.indoor} == 'n' ? '실외' : '실내'"></span></td>
                </tr>
                <tr>
                    <th>잔디유무</th>
                    <td><span th:text="${groundViewDto.groundInfo.floor} == 'n' ? '잔디없음' : '잔디있음'"></span></td>
                </tr>
                <tr>
                    <th>음료</th>
                    <td><span id="water" th:text="${groundViewDto.groundInfo.water} == 'n' ? '음료없음' : '음료판매'"></span></td>
                </tr>
            </table>
        </div>

        <!--편의시설-->
        <div class="box">
            <div class="info-table">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-diamond-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435z"/>
                </svg><span class="h5">대여/사용 가능 여부</span><br/>
            </div>
            <div class="d-flex justify-content-around py-3">
                <div th:classappend="${groundViewDto.amenities.ball} == 'n' ? 'd-none':''"><img src="/img/site/ball.jpg" alt="공대여 가능" title="공대여 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.ball} == 'y' ? 'd-none':''"><img src="/img/site/noball.jpg" alt="공대여 불가" title="공대여 불가" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.vest} == 'n' ? 'd-none':''"><img src="/img/site/vest.jpg" alt="조끼대여 가능" title="조끼대여 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.vest} == 'y' ? 'd-none':''"><img src="/img/site/novest.jpg" alt="조끼대여 불가" title="조끼대여 불가" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.shoes} == 'n' ? 'd-none':''"><img src="/img/site/shoes.jpg" alt="풋살화대여 가능" title="풋살화대여 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.shoes} == 'y' ? 'd-none':''"><img src="/img/site/noshoes.jpg" alt="풋살화대여 불가" title="풋살화대여 불가" width="100" height="90"/></div>
            </div>
            <div class="d-flex justify-content-around">
                <div th:classappend="${groundViewDto.amenities.shower} == 'n' ? 'd-none':''"><img src="/img/site/shower.png" alt="샤워가능 가능" title="샤워 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.shower} == 'y' ? 'd-none':''"><img src="/img/site/noshower.png" alt="샤워가능 불가" title="샤워 불가" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.parking} == 'n' ? 'd-none':''"><img src="/img/site/park.jpg" alt="주차가능 가능" title="주차 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.parking} == 'y' ? 'd-none':''"><img src="/img/site/nopark.jpg" alt="주차가능 불가" title="주차 불가" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.hotcold} == 'n' ? 'd-none':''"><img src="/img/site/coldhot.jpg" alt="냉난방 가능" title="냉난방 가능" width="100" height="90"/></div>
                <div th:classappend="${groundViewDto.amenities.hotcold} == 'y' ? 'd-none':''"><img src="/img/site/nocoldhot.jpg" alt="냉난방 불가" title="냉난방 불가" width="100" height="90"/></div>
            </div>
        </div>
    </div>

    <!--시간예약-->
    <div class="my-5 mx-3 d-flex justify-content-between">
        <div>
            <span class="h3">날자 선택</span>
        </div>
        <div class="mx-5">
            <select class="custom-select d-block w-100" id="day" name="day" onchange="cngFrame(this.value);">
                <th:block th:each="num : ${#numbers.sequence(0, 29)}">
                    <option><span th:text="${#temporals.format(now.plusDays(num), 'yyyy-MM-dd(E)')}"></span></option>
                </th:block>
            </select>
        </div>
        <div>
            <button class="btn btn-primary" data-target="#myModal" onclick="goRev();">예약하기</button>
        </div>
    </div>
    <div id="timeWrap">
        <div class="my-5 mx-3" th:classappend="${#strings.contains(groundViewDto.timeAndCost.openday, (#temporals.format(now, 'E')))} ? '' : 'd-none'">

            <span class="h3">시간 선택</span>
            <div class="my-3">
                <div class="d-flex justify-content-around">
                    <table class="time-ex">
                        <tr>
                            <td width="30px" bgcolor="#adff2f"></td>
                            <td width="20px"></td>
                            <td>가능</td>
                            <td width="30px"></td>
                            <td width="30px" bgcolor="#a9a9a9"></td>
                            <td width="20px"></td>
                            <td>불가</td>
                        </tr>
                    </table>
                    <div>
                        <span id="msg">시간을 선택해 주세요</span>
                    </div>
                    <div>
                        <span id="money">총 금액 : 0원</span>
                    </div>
                </div>
                <div class="d-flex justify-content-around" id="timeColor">
                    <input th:value="${revs}" class="d-none" id="cngtime" />
                    <div class="06~08 rev" id="a" th:classappend="${revs.contains('06~08')} ? 'reserved'" onclick="chkRev(this.id);">06~08</div>
                    <div class="08~10 rev" id="b" th:classappend="${revs.contains('08~10')} ? 'reserved'" onclick="chkRev(this.id);">08~10</div>
                    <div class="10~12 rev" id="c" th:classappend="${revs.contains('10~12')} ? 'reserved'" onclick="chkRev(this.id);">10~12</div>
                    <div class="12~14 rev" id="d" th:classappend="${revs.contains('12~14')} ? 'reserved'" onclick="chkRev(this.id);">12~14</div>
                    <div class="14~16 rev" id="e" th:classappend="${revs.contains('14~16')} ? 'reserved'" onclick="chkRev(this.id);">14~16</div>
                    <div class="16~18 rev" id="f" th:classappend="${revs.contains('16~18')} ? 'reserved'" onclick="chkRev(this.id);">16~18</div>
                    <div class="18~20 rev" id="g" th:classappend="${revs.contains('18~20')} ? 'reserved'" onclick="chkRev(this.id);">18~20</div>
                    <div class="20~22 rev" id="h" th:classappend="${revs.contains('20~22')} ? 'reserved'" onclick="chkRev(this.id);">20~22</div>
                    <div class="22~24 rev" id="i" th:classappend="${revs.contains('22~24')} ? 'reserved'" onclick="chkRev(this.id);">22~24</div>
                    <br />
                </div>
                <div class="d-none">
                    <input type="checkbox" value="a" name="slt" />
                    <input type="checkbox" value="b" name="slt" />
                    <input type="checkbox" value="c" name="slt" />
                    <input type="checkbox" value="d" name="slt" />
                    <input type="checkbox" value="e" name="slt" />
                    <input type="checkbox" value="f" name="slt" />
                    <input type="checkbox" value="g" name="slt" />
                    <input type="checkbox" value="h" name="slt" />
                    <input type="checkbox" value="i" name="slt" />
                </div>
            </div>
        </div>
        <div class="border text-center text-danger py-3" th:classappend="${#strings.contains(groundViewDto.timeAndCost.openday, (#temporals.format(now, 'E')))} ? 'd-none' : ''">
            <span class="h4" th:text="'해당 구장은 ' + ${groundViewDto.timeAndCost.openday} + ' 요일만 운영합니다'"></span>
        </div>
    </div>

    <div>
        <p class="h3">구장 이용 정보</p>
        <p>
            <textarea cols="150" rows="17" readonly="readonly" th:text="${groundViewDto.groundInfo.rule}"></textarea>
        </p>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form role="form" th:action="@{/ground/createReservation}" th:object="${reservationDto}" method="post">

                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">구장 예약</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                        <div>
                            <div>예약자 : <span th:text="${session.member} == null ? '로그인이 필요합니다.' : ${session.member.email}"></span></div>
                            <div>구장이름 : <span th:text="${groundViewDto.grdName}"></span></div>
                            <div>구장위치 : <span th:text="${groundViewDto.roadAddr}"></span></div>
                            <div>예약일시 : <span id="when">시간을 선택해 주세요</span></div>
                            <div>예약금액 : <span id="cost"></span></div>
                            <div class="py-2"> 결제 방법을 선택하세요 </div>
                            <div>
                                <label for="card"><input type="radio" name="payMethod" checked="checked" id="card" value="c" /> 체크/신용카드</label>
                                <label for="mobile"><input type="radio" name="payMethod" id="mobile" value="m" /> 휴대폰결제</label>
                                <label for="trans"><input type="radio" name="payMethod" id="trans" value="t"> 계좌이체</label>
                            </div>
                        </div>
                        <div class="d-none">
                            <input type="text" name="grdId" id="grdId" th:value="${groundViewDto.id}">
                            <input type="text" th:field="*{cost}" id="cost2">
                            <input type="text" name="reserveDate" id="when1">
                            <input type="text" th:field="*{revTime}" id="when2">
                        </div>
                </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                        <button type="submit" class="btn btn-primary">예약하기</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    function open() {
        var box = document.getElementById("a");     cngBox(box);
        box = document.getElementById("b");			cngBox(box);
        box = document.getElementById("c");			cngBox(box);
        box = document.getElementById("d");			cngBox(box);
        box = document.getElementById("e");			cngBox(box);
        box = document.getElementById("f");			cngBox(box);
        box = document.getElementById("g");			cngBox(box);
        box = document.getElementById("h");			cngBox(box);
        box = document.getElementById("i");			cngBox(box);
    }

    window.onload=open;
</script>
<script th:inline="javascript">
    function chkRev(id) {
        var id = id;
        var box = document.getElementById(id);
        var slt = document.getElementsByName("slt");
        if (box.innerHTML == "예약 불가") {
            alert("예약이 불가합니다.");
            return;
        } else {
            if (box.style.backgroundColor == "red") {
                box.style.backgroundColor = "#adff2f";
                box.innerHTML = box.className.substring(0, 6);
                for (var i = 0; i < slt.length; i++) {
                    if (slt[i].value == id) {
                        slt[i].checked = false;
                    }
                }
            } else {
                box.style.backgroundColor = "red";
                box.innerHTML = "선택";
                for (var i = 0; i < slt.length; i++) {
                    if (slt[i].value == id) {
                        slt[i].checked = true;
                    }
                }
            }
            var num = 0;
            for (var i = 0; i < slt.length; i++) {
                if (slt[i].checked) num++;
            }
        }
        cngMsg(num);
    }
</script>
<script th:inline="javascript">
    function cngBox(box) {
        var time = [[${groundViewDto.timeAndCost.startTime}]];
        var nowDate = [[${groundViewDto.nowDate}]];
        var nowTime = [[${groundViewDto.nowTime}]];
        var sltDate = document.getElementById("day").value.substring(0, 10);
        var reserve = box.className;
        if (time.indexOf(box.id) < 0 || reserve.includes("reserve")) {
            box.style.backgroundColor = "gray";
            box.innerHTML = "예약 불가";
        }
        if (nowDate == sltDate && nowTime >= box.className.substring(0, 2)) {
            box.style.backgroundColor = "gray";
            box.innerHTML = "예약 불가";
        }
    }
</script>
<script th:inline="javascript">

    function cngMsg(num) {
        var msg = document.getElementById("msg");
        var cost = [[${groundViewDto.timeAndCost.cost}]];
        var money = document.getElementById("money");
        if (num == 0) {
            msg.innerHTML = "시간을 선택해 주세요.";
            money.innerHTML = "총 금액 : 0원";
        } else {
            msg.innerHTML = num + " 개를 선택하셨습니다.";
            money.innerHTML = "총 금액 : " + (cost * num) + " 원";
        }
    }
</script>

<script th:inline="javascript">
    function cngFrame(val) {
        var changeBox = document.getElementById("when");
        var slt = document.getElementsByName("slt");
        for (var i = 0; i < slt.length; i++) {
            slt[i].checked = false;
        }
        changeBox.innerHTML = val;
        changeTimeInView();

    }
</script>

<script th:inline="javascript">
    function goRev() {
        var isLogin = [[${session.member} == null ? 'no' : 'yes']];
        if (isLogin == 'no') {
            alert("로그인 후 예약할 수 있습니다.");
            location.href = "/member/login";
            return;
        }
        var slt = "";
        var viewTime = " ";
        var sltTime = document.getElementsByName("slt");
        var sltNum = 0;
        for (var i = 0; i < sltTime.length; i++) {
            if (sltTime[i].checked) {
                sltNum++;
                slt += document.getElementById(sltTime[i].value).className.substring(0, 6) + " ";
                viewTime += document.getElementById(sltTime[i].value).className.substring(0, 6) + " ";
            }
        }
        if (sltNum == 0) {
            alert("시간을 선택하세요.");
            return false;
        }

        var timeBox = document.getElementById("when");
        var costBox = document.getElementById("cost");
        var timeBox1 = document.getElementById("when1");
        var timeBox2 = document.getElementById("when2");
        var costBox2 = document.getElementById("cost2");

        var sltDay = document.getElementById("day").value;
        var totalCost = sltNum * [[${groundViewDto.timeAndCost.cost}]];


        timeBox.innerText = sltDay + viewTime;
        costBox.innerText = totalCost;
        timeBox1.value = sltDay.substring(0, sltDay.length - 3);
        timeBox2.value = slt;
        costBox2.value = totalCost;

        $('#exampleModal').modal('show')
    }
</script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<!--<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<!--<script src="https://code.jquery.com/jquery-3.4.1.js"></script>-->
<script th:src="@{/js/showReservation.js}"></script>

</body>
</html>